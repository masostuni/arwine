<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto-AR Wine Viewer</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        
        #status {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 1000;
        }
        
        model-viewer {
            width: 100%;
            height: 100%;
            background-color: #f5f5f5;
        }
        
        /* Nasconde il pulsante AR predefinito */
        model-viewer::part(ar-button) {
            display: none;
        }
    </style>
    <!-- Import model-viewer -->
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</head>
<body>
    <div id="status">Inizializzazione AR automatica...</div>
    
    <model-viewer 
        id="wine-model"
        src="wine.glb"
        ar
        ar-modes="webxr scene-viewer quick-look"
        camera-controls
        auto-rotate
        shadow-intensity="1"
        camera-orbit="45deg 55deg 2m"
        ar-placement="floor"
        ar-scale="auto"
        ar-status="not-presenting">
    </model-viewer>
    
    <script>
        const status = document.getElementById('status');
        const modelViewer = document.getElementById('wine-model');
        
        // Funzione per avviare AR automaticamente
        async function startARAutomatically() {
            status.innerHTML = "Avvio AR automatico...";
            
            try {
                // Attendi il caricamento del modello
                if (!modelViewer.loaded) {
                    await new Promise(resolve => {
                        modelViewer.addEventListener('load', resolve, {once: true});
                        
                        // Timeout per evitare attese infinite
                        setTimeout(resolve, 5000);
                    });
                }
                
                // Controlla se AR Ã¨ disponibile
                const isARAvailable = modelViewer.canActivateAR;
                
                if (isARAvailable) {
                    // Avvia AR automaticamente
                    try {
                        await modelViewer.activateAR();
                        status.innerHTML = "AR attivato automaticamente";
                    } catch (arError) {
                        console.error("Errore nell'attivazione AR:", arError);
                        status.innerHTML = "Errore nell'attivazione AR - visualizzazione 3D";
                    }
                } else {
                    status.innerHTML = "AR non disponibile - visualizzazione 3D";
                }
            } catch (error) {
                console.error("Errore nell'avvio automatico:", error);
                status.innerHTML = "Visualizzazione 3D (AR non disponibile)";
            }
        }
        
        // Eventi model-viewer
        modelViewer.addEventListener('load', () => {
            status.innerHTML = "Modello caricato, preparazione AR...";
        });
        
        modelViewer.addEventListener('ar-status', (event) => {
            if (event.detail.status === 'session-started') {
                status.innerHTML = "Esperienza AR attiva";
            } else if (event.detail.status === 'not-presenting') {
                status.innerHTML = "Visualizzazione 3D";
            } else if (event.detail.status === 'failed') {
                status.innerHTML = "AR non disponibile: " + event.detail.error;
            }
        });
        
        // Controllo errori di caricamento
        modelViewer.addEventListener('error', (error) => {
            console.error('Errore nel caricamento del modello:', error);
            status.innerHTML = "Errore: verifica che il file wine.glb esista";
        });
        
        // Avvia AR automaticamente dopo il caricamento della pagina
        window.addEventListener('DOMContentLoaded', () => {
            // Piccolo ritardo per assicurarsi che tutto sia caricato
            setTimeout(startARAutomatically, 1000);
        });
    </script>
</body>
</html>
